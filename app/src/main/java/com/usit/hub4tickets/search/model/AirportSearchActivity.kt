package com.usit.hub4tickets.search.modelimport android.app.Activityimport android.content.Intentimport android.os.Bundleimport android.support.v7.widget.LinearLayoutManagerimport android.support.v7.widget.RecyclerViewimport android.support.v7.widget.SearchViewimport android.view.Viewimport com.usit.hub4tickets.Rimport com.usit.hub4tickets.dashboard.model.DashboardViewModelimport com.usit.hub4tickets.domain.presentation.presenters.DashboardPresenterimport com.usit.hub4tickets.domain.presentation.screens.BaseActivityimport com.usit.hub4tickets.domain.presentation.screens.main.DashboardPresenterImplimport com.usit.hub4tickets.search.CommonSearchAdapterimport com.usit.hub4tickets.utils.PrefConstantsimport com.usit.hub4tickets.utils.Utilityimport kotlinx.android.synthetic.main.activity_comman_serach.*/** * Created by Bhagyashri Burade * Date: 24/10/2018 * Email: bhagyashri.burade@usit.net.in */class AirportSearchActivity : BaseActivity(), DashboardPresenter.MainView {    private var searchItemsListAdapter: CommonSearchAdapter? = null    private var strActivityTitle: String? = ""    private lateinit var model: DashboardViewModel    private lateinit var presenter: DashboardPresenter    private var arrayListCommonSelectorFromInitial: ArrayList<DashboardViewModel.AirportDataResponse.ResponseData> =        ArrayList()    override fun doRetrieveModel(): DashboardViewModel = this.model    override fun showState(viewState: DashboardPresenter.MainView.ViewState) {        when (viewState) {            DashboardPresenter.MainView.ViewState.IDLE -> Utility.showProgress(false, this)            DashboardPresenter.MainView.ViewState.LOADING -> Utility.showProgress(true, this)            DashboardPresenter.MainView.ViewState.AIRPORTS_SUCCESS -> {                presenter.presentState(DashboardPresenter.MainView.ViewState.IDLE)                arrayListCommonSelectorFromInitial.addAll(model.dashboradAirportDomain.responseData as ArrayList<DashboardViewModel.AirportDataResponse.ResponseData>)                initView()            }            DashboardPresenter.MainView.ViewState.ERROR -> {                arrayListCommonSelectorFromInitial?.clear()                searchItemsListAdapter?.notifyDataSetChanged()                presenter.presentState(DashboardPresenter.MainView.ViewState.IDLE)                Utility.showCustomDialog(this, doRetrieveModel().errorMessage.message, "", null)            }        }    }    override fun onCreate(savedInstanceState: Bundle?) {        super.onCreate(savedInstanceState)        setContentView(R.layout.activity_comman_serach)        this.model = DashboardViewModel(this)        this.presenter = DashboardPresenterImpl(this, this)        callAPIAirportData()        var searchTextView = this.findViewById<SearchView>(R.id.search_text)        searchTextView.setOnQueryTextListener(object : SearchView.OnQueryTextListener {            override fun onQueryTextSubmit(query: String?): Boolean {                query?.replace("\\s+$".toRegex(), "")                searchItemsListAdapter!!.getFilter().filter(query)                return false            }            override fun onQueryTextChange(newText: String?): Boolean {                searchItemsListAdapter!!.getFilter().filter(newText!!.trim { it <= ' ' })                return false            }        })    }    private fun initView() {        val arrayListCommonSelector: ArrayList<CommonSelectorPojo> = ArrayList()        if (arrayListCommonSelectorFromInitial != null) {            for (i in arrayListCommonSelectorFromInitial!!.indices) {                arrayListCommonSelector.add(                    i, CommonSelectorPojo(                        arrayListCommonSelectorFromInitial[i].airPortId.toString(),                        arrayListCommonSelectorFromInitial[i].airPortName,                        arrayListCommonSelectorFromInitial[i].airPortCode                    )                )            }        }        if (null != arrayListCommonSelector) {            searchItemsListAdapter = CommonSearchAdapter(                strActivityTitle,                arrayListCommonSelector,                object : CommonSearchAdapter.OnItemClickListener {                    override fun onListItemClick(data: CommonSelectorPojo) {                        Utility.hideKeyBordActivity(this@AirportSearchActivity)                        val intent = Intent()                        intent.putExtra(PrefConstants.SELECTED_ITEMS_ID, data.id)                        intent.putExtra(PrefConstants.SELECTED_ITEMS_NAME, data.itemsName)                        intent.putExtra(PrefConstants.SELECTED_ITEMS_TYPE, data.id)                        setResult(Activity.RESULT_OK, intent)                        finish()                    }                    override fun onNoData(isVisible: Boolean) {                        if (isVisible) {                            txt_no_data!!.visibility = View.VISIBLE                        } else {                            txt_no_data!!.visibility = View.GONE                        }                    }                })            val mLayoutManager = LinearLayoutManager(this)            recycler_city_list!!.layoutManager = mLayoutManager as RecyclerView.LayoutManager?            recycler_city_list!!.adapter = searchItemsListAdapter        }    }    override fun onBackPressed() {        Utility.hideKeyBordActivity(this)        super.onBackPressed()    }    private fun callAPIAirportData() {        presenter.callAPIAirports()    }    override fun getLayoutResource(): Int {        return R.layout.common_toolbar    }}